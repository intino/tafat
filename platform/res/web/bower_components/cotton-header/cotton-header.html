<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../cotton-user/cotton-user.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../neon-animation/animations/slide-from-top-animation.html">
<link rel="import" href="../neon-animation/animations/slide-up-animation.html">

<dom-module id="cotton-header">
  <style>

    :host {
      display: block;
    }

    paper-toolbar {
      background-color: var(--header-background-color, --primary-color);
      color: var(--header-text-color, --text-primary-color);
    }

    .info {
      @apply(--layout-horizontal);
    }

    .info > div {
      @apply(--layout-vertical);
      @apply(--layout-center-justified);
      padding: 0 12px;
    }

    .info, cotton-user, .user-content {
      z-index: 10;
    }

    .app-name {
      font-size: 28px;
    }

    img {
      width: 60px;
      height: 60px;
      cursor: pointer;
    }

    .middle-container  {
      margin: 5px 76px;
      height: 100%;
      @apply(--layout-self-start);
    }

    .middle-container {
      font-size: 18px;
      padding-bottom: 0;
    }

    .bottom-container {
      margin: 5px 76px;
      @apply(--layout-self-end);
    }

    span {
      @apply(--layout-flex);
    }

    .content {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      @apply(--layout-horizontal);
      @apply(--layout-center-justified);
      @apply(--layout-center);
    }

    div.separator {
      display: block;
      height: 1px;
      background-color: var(--divider-color, #000);
    }

    @media all and (max-width: 600px) {
        .app-name, .bottom-title {
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          width: 200px;
        }

        img {
          width: 52px;
          height: 52px;
        }

        div.content {
          display: none !important;
        }
    }
  </style>
  <template>
    <paper-toolbar>
      <div class="info">
        <img src="[[logo]]" alt="Logo" on-tap="_notifyHome" />
        <div>
          <div class="app-name">[[title]]</div>
          <div class="bottom-title">[[subtitle]]</div>
        </div>
      </div>
      <span></span>
      <div class="content">
        <content select="#header-content"></content>
      </div>
      <template is="dom-if" if="[[_userPresent()]]">
        <cotton-user full-name="[[user.fullName]]" photo="[[user.photo]]"></cotton-user>
      </template>
      <template is="dom-if" if="[[_userNotPresent()]]">
        <div class="user-content"><content select="#user-content"></content></div>
      </template>
    </paper-toolbar>
    <div class="separator"></div>
  </template>

  <script>
    Polymer({
      is: 'cotton-header',

      properties: {
        logo: String,
        title: String,
        subtitle: String,
        user: Object,
        animationConfig: {
          type: Object,
          value: function () {
            return {
              'show': [{
                name: 'slide-from-top-animation',
                node: this
              }],
              'hide': [{
                name: 'slide-up-animation',
                node: this
              }]
            };
          }
        },
        _opened: Boolean
      },

      behaviors: [Polymer.NeonAnimationRunnerBehavior],

      listeners: {
        'neon-animation-finish': '_onNeonAnimationFinish'
      },

      show: function () {
        this.playAnimation('show');
        this._opened = true;
        this.style.display = 'block';
      },

      hide: function () {
        this.playAnimation('hide');
        this._opened = false;
      },

      _notifyHome: function () {
        this.fire('home');
      },

      _userPresent : function() {
        return this.user != null;
      },

      _userNotPresent : function() {
          return this.user == null;
      },

      _onNeonAnimationFinish: function () {
        if (!this._opened) {
          this.style.transform = 'translateY(-100%)';
          this.style.display = 'none';
        } else {
          this.style.transform = 'translateY(0%)';
        }
      }
    });
  </script>
</dom-module>